name: Build MainsailOS
on:
  workflow_dispatch:

jobs:
  raspiosbuild:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout MainsailOS Project
        uses: actions/checkout@v3
        with:
          repository: ${{ github.repository }}

      - name: Get Raspberry Pi OS bullseye Image
        run: make get_latest

      - name: Run CustoPiZer
        uses: OctoPrint/CustoPiZer@main
        with:
          workspace: "${{ github.workspace }}/workspace"
          scripts: "${{ github.workspace }}/workspace/scripts"
          config: "${{ github.workspace }}/workspace/config.local"

      - name: Compress Image
        run: make compress

      # - name: Compress the image
      #   run: zip mainsailos-raspios-lite-latest.zip mainsailos-raspios-lite-latest.img

      # - uses: actions/upload-artifact@v2
      #   with:
      #     name: mainsailos-raspios-lite-latest.zip
      #     path: mainsailos-raspios-lite-latest.zip
